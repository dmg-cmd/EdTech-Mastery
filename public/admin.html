<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdTech Mastery - Panel del Profesor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-left">
                <h1>EdTech Mastery</h1>
                <span class="status-badge" id="connection-status">Conectado</span>
            </div>
            <div class="header-center">
                <div class="game-status" id="game-status">
                    <span class="status-dot"></span>
                    <span class="status-text">En Lobby</span>
                </div>
            </div>
            <div class="header-right">
                <div class="player-count">
                    <span class="count-icon">üë•</span>
                    <span class="count-number" id="player-count">0</span>
                    <span class="count-label">jugadores</span>
                </div>
            </div>
        </header>

        <!-- Panel Principal -->
        <main class="admin-main">
            <!-- Vista Lobby -->
            <section id="lobby-view" class="view active">
                <div class="lobby-content">
                    <div class="qr-section">
                        <h2>üì± Conexion de Alumnos</h2>
                        <p class="qr-instruction">Los alumnos deben escanear este codigo QR o acceder a la URL:</p>
                        
                        <div class="qr-container">
                            <canvas id="qr-canvas"></canvas>
                            <div class="url-display" id="connection-url">
                                Cargando...
                            </div>
                        </div>
                        
                        <div class="connection-info">
                            <div class="info-item">
                                <span class="info-label">O accede directamente:</span>
                                <a href="#" id="direct-link" class="direct-link">Cargando...</a>
                            </div>
                        </div>
                    </div>

                    <div class="players-section">
                        <h2>üë• Jugadores Conectados</h2>
                        <div class="players-list" id="players-list">
                            <div class="empty-state">
                                <span class="empty-icon">üîç</span>
                                <p>Esperando jugadores...</p>
                            </div>
                        </div>
                    </div>

                    <div class="start-section">
                        <button class="btn-primary btn-large" id="btn-start-game">
                            <span class="btn-icon">‚ñ∂Ô∏è</span>
                            Iniciar Juego
                        </button>
                        <p class="start-hint">Se necesitan al menos 1 jugador para comenzar</p>
                    </div>
                </div>
            </section>

            <!-- Vista Juego -->
            <section id="game-view" class="view">
                <div class="game-content">
                    <!-- Panel Izquierdo: Pregunta -->
                    <div class="question-panel">
                        <div class="question-header">
                            <span class="question-number" id="question-number">Pregunta 1/10</span>
                            <span class="timer-display" id="timer-display">30s</span>
                        </div>
                        
                        <div class="question-card">
                            <div class="category-badge" id="question-category">Categoria</div>
                            <h2 class="question-text" id="question-text">
                                Cargando pregunta...
                            </h2>
                            <p class="question-context" id="question-context"></p>
                        </div>

                        <div class="question-controls">
                            <button class="btn-secondary" id="btn-reveal">
                                Revelar Respuesta
                            </button>
                            <button class="btn-primary" id="btn-next">
                                Siguiente Pregunta ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Panel Derecho: Estadisticas -->
                    <div class="stats-panel">
                        <h3>üìä Respuestas en Tiempo Real</h3>
                        
                        <div class="answer-chart">
                            <div class="chart-row" data-index="0">
                                <span class="option-label">A</span>
                                <div class="option-bar-container">
                                    <div class="option-bar" id="bar-0"></div>
                                </div>
                                <span class="option-count" id="count-0">0</span>
                            </div>
                            <div class="chart-row" data-index="1">
                                <span class="option-label">B</span>
                                <div class="option-bar-container">
                                    <div class="option-bar" id="bar-1"></div>
                                </div>
                                <span class="option-count" id="count-1">0</span>
                            </div>
                            <div class="chart-row" data-index="2">
                                <span class="option-label">C</span>
                                <div class="option-bar-container">
                                    <div class="option-bar" id="bar-2"></div>
                                </div>
                                <span class="option-count" id="count-2">0</span>
                            </div>
                            <div class="chart-row" data-index="3">
                                <span class="option-label">D</span>
                                <div class="option-bar-container">
                                    <div class="option-bar" id="bar-3"></div>
                                </div>
                                <span class="option-count" id="count-3">0</span>
                            </div>
                        </div>

                        <div class="response-stats">
                            <div class="stat-row">
                                <span>Respondieron:</span>
                                <span id="answered-count">0 / 0</span>
                            </div>
                            <div class="stat-row highlight">
                                <span>Sin responder:</span>
                                <span id="pending-count">0</span>
                            </div>
                        </div>

                        <div class="leaderboard-preview">
                            <h4>Top 5</h4>
                            <ol class="leaderboard-list" id="leaderboard-preview">
                                <li class="empty">Esperando...</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- Panel de Respuesta Revelada -->
                <div class="answer-reveal-panel" id="answer-reveal">
                    <div class="reveal-content">
                        <div class="correct-answer">
                            <span class="reveal-icon">‚úì</span>
                            <span class="reveal-text">Respuesta Correcta</span>
                            <span class="reveal-option" id="correct-option">B</span>
                        </div>
                        <p class="reveal-explanation" id="reveal-explanation">
                            La explicacion de la respuesta...
                        </p>
                        <div class="reveal-stats">
                            <span class="stat correct">‚úÖ <span id="reveal-correct">0</span> correctas</span>
                            <span class="stat wrong">‚ùå <span id="reveal-wrong">0</span> incorrectas</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Vista Resultados Finales -->
            <section id="results-view" class="view">
                <div class="results-content">
                    <div class="results-header">
                        <h2>üéâ ¬°Juego Completado!</h2>
                        <p class="results-summary" id="results-summary">
                            Todos los participantes han completado el diagnostico
                        </p>
                    </div>

                    <div class="results-grid">
                        <!-- Ganador -->
                        <div class="winner-card">
                            <div class="winner-crown">üëë</div>
                            <div class="winner-avatar">üèÜ</div>
                            <h3 class="winner-name" id="winner-name">-</h3>
                            <p class="winner-score" id="winner-score">0 puntos</p>
                        </div>

                        <!-- Estadisticas Generales -->
                        <div class="general-stats">
                            <div class="stat-card">
                                <span class="stat-value" id="total-players">0</span>
                                <span class="stat-label">Participantes</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-value" id="avg-score">0</span>
                                <span class="stat-label">Promedio</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-value" id="avg-correct">0%</span>
                                <span class="stat-label">Aciertos</span>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de Posiciones -->
                    <div class="final-leaderboard">
                        <h3>üìã Clasificacion Final</h3>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nombre</th>
                                    <th>Especialidad</th>
                                    <th>Aciertos</th>
                                    <th>Puntos</th>
                                </tr>
                            </thead>
                            <tbody id="final-leaderboard-body">
                            </tbody>
                        </table>
                    </div>

                    <!-- Estadisticas por Categoria -->
                    <div class="category-results">
                        <h3>üìä Desempeno por Categoria</h3>
                        <div class="category-bars" id="category-bars">
                        </div>
                    </div>

                    <div class="results-actions">
                        <button class="btn-secondary" id="btn-export-results">
                            üì• Exportar Resultados
                        </button>
                        <button class="btn-primary" id="btn-restart-game">
                            üîÑ Nueva Partida
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Socket.io -->
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- QR Code Generator - Libreria simple y funcional -->
    <script>
    // QRCode Simple - Generador de codigos QR real y funcional
    var qrcode=function(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]};
    qrcode.prototype={addData:function(t){var e=new qrcode.util.QRData(t);this.dataList.push(e),this.dataCache=null},isDark:function(t,e){if(0>t||this.moduleCount<=t||0>e||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){if(this.moduleCount<1){var t=0;for(var e=0;e<this.dataList.length;e++)t+=this.dataList[e].getLength();this.typeNumber=qrcode.util.getBestTypeNumber(t,this.errorCorrectLevel),this.moduleCount=4*this.typeNumber+17}this.modules=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++){this.modules[e]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[e][r]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(0,0),this.setupTypeNumber(this.moduleCount-8,6),this.mapData(this.createData(this.typeNumber,this.errorCorrectLevel,this.dataList),0)},setupPositionProbePattern:function(t,e){for(var r=-1;7>=r;r++)if(!(-1>=t+r||this.moduleCount<=t+r))for(var n=-1;7>=n;n++)-1>=e+n||this.moduleCount<=e+n||(this.modules[t+r][e+n]=0<=r&&6>=r&&(0==n||6==n)||0<=n&&6>=n&&(0==r||6==r)||2<=r&&4>=r&&2<=n&&4>=n?!0:!1)},setupPositionAdjustPattern:function(){for(var t=qrcode.util.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var n=t[e],o=t[r];if(null===this.modules[n][o])for(var a=-2;2>=a;a++)for(var i=-2;2>=i;i++)this.modules[n+a][o+i]=-2==a||2==a||-2==i||2==i||0==a&&0==i}},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null===this.modules[t][6]&&(this.modules[t][6]=0==t%2);for(var e=8;e<this.moduleCount-8;e++)null===this.modules[6][e]&&(this.modules[6][e]=0==e%2)},setupTypeInfo:function(t,e){for(var r=this.errorCorrectLevel<<3|qrcode.util.getBCHTypeInfo(this.dataList[0].getErrorCorrectLevel()<<3|this.dataList[0].getMode()),n=0;15>n;n++){var o=!e&&0!=(1&r>>n);0<=t&&t<6&&(this.modules[t][8-n]=o),8<=t&&t<this.moduleCount-8&&(this.modules[t][8-n]=o),0<=e&&e<6&&(this.modules[8-n][e]=o),this.moduleCount-7<=e&&e<this.moduleCount-8&&(this.modules[8-n][e]=o)}var a=this.moduleCount-8;for(var n=0;15>n;n++){var o=!e&&0!=(1&r>>n);0<=t&&t<6&&(this.modules[8-n][t]=o),8<=t&&t<this.moduleCount-8&&(this.modules[8-n][t]=o),0<=e&&e<6&&(this.modules[e][8-n]=o),a<=e&&e<this.moduleCount-8&&(this.modules[e][8-n]=o)}},setupTypeNumber:function(t,e){for(var r=qrcode.util.getBCHTypeNumber(this.typeNumber),n=0;18>n;n++){var o=!e&&0!=(1&r>>n);this.modules[Math.floor(n/3)][e+n%3+this.moduleCount-11]=o;var a=e+Math.floor(n/3),i=n%3;this.modules[a][i]=o,0<=a&&a<6&&(this.modules[a][8]=o),6<=i&&i<8&&(this.modules[a-6][8]=o)}},mapData:function(t,e){for(var r=-1,n=this.moduleCount-1,o=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var i=0;2>i;i++)if(null===this.modules[n][a-i]){var u=!1;o<t.length&&(u=1==(1&t[o]>>>7-i));var h=qrcode.util.getMask(0,n,a-i);this.modules[n][a-i]=h&&u,0==i&&o++,0>o&&(o=7)}if(n+=r,0>n||this.moduleCount<=n){n-=r,r=-r;break}}},createData:function(t,e,r){for(var n=qrcode.util.getRSBlocks(t,e),o=new qrcode.util.BitBuffer,a=0;a<r.length;a++){var i=r[a];o.put(i.getMode(),4),o.put(i.getLength(),qrcode.util.getLengthInBits(i.getMode(),t)),i.write(o)}for(var u=0,a=0;a<n.length;a++)u+=n[a].dataCount;if(o.getLengthInBits()>8*u)throw new Error("code length overflow");for(o.getLengthInBits()+4<=8*u&&o.put(0,4);0!=o.getLengthInBits()%8;)o.putBit(!1);for(;;){if(o.getLengthInBits()>=8*u)break;if(o.put(236,8),o.getLengthInBits()>=8*u)break;o.put(17,8)}return qrcode.util.createBytes(o,n)}};
    qrcode.util={getPatternPosition:function(t){return qrcode.util.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,r){switch(t){case 0:return(e+r)%2==0;case 1:return e%2==0;case 2:return r%3==0;case 3:return(e+r)%3==0;case 4:return(Math.floor(e/2)+Math.floor(r/3))%2==0;case 5:return(e*r)%2+(e*r)%3==0;case 6:return(e*r)%2+(e*r)%3%2==0;case 7:return(e*r%3+(e+r)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getBCHTypeInfo:function(t){for(var e=t<<10;qrcode.util.getBCHDigit(e)-qrcode.util.getBCHDigit(qrcode.util.G15)>=0;)e^=qrcode.util.G15<<qrcode.util.getBCHDigit(e)-qrcode.util.getBCHDigit(qrcode.util.G15);return(t<<10|e)^qrcode.util.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;qrcode.util.getBCHDigit(e)-qrcode.util.getBCHDigit(qrcode.util.G18)>=0;)e^=qrcode.util.G18<<qrcode.util.getBCHDigit(e)-qrcode.util.getBCHDigit(qrcode.util.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getLengthInBits:function(t,e){if(1<=e&&10>e)switch(t){case 1:return 10;case 2:return 9;case 4:return 8;case 8:return 8;default:throw new Error("mode:"+t)}else if(27>e)switch(t){case 1:return 12;case 2:return 11;case 4:return 16;case 8:return 10;default:throw new Error("mode:"+t)}else switch(t){case 1:return 14;case 2:return 13;case 4:return 16;case 8:return 12;default:throw new Error("mode:"+t)}},getBestTypeNumber:function(t,e){for(var r=1;40>=r;r++)if(t<=qrcode.util.getRSBlocks(r,e)*qrcode.util.getMaxDataWords(r))return r;throw new Error("type number overflow")},getRSBlocks:function(t,e){var r=qrcode.util.getRsBlockTable(t,e);if(void 0==r)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var n=r.length/3,o=new Array,a=0;n>a;a++)for(var i=r[3*a+0],u=r[3*a+1],h=r[3*a+2],l=0;i>l;l++)o.push(new qrcode.util.RSBlock(u,h));return o},getRsBlockTable:function(t,e){switch(e){case 1:return qrcode.util.RS_BLOCK_TABLE[(t-1)*4+0];case 0:return qrcode.util.RS_BLOCK_TABLE[(t-1)*4+1];case 3:return qrcode.util.RS_BLOCK_TABLE[(t-1)*4+2];case 2:return qrcode.util.RS_BLOCK_TABLE[(t-1)*4+3];default:return void 0}},getMaxDataWords:function(t,e){return(40==t?1e3:0)|qrcode.util.getMaxDataWords(t,e)},createBytes:function(t,e){for(var r=0,n=0,o=0,a=new Array(e.length),i=new Array(e.length),u=0;u<e.length;u++){var h=e[u].totalCount,l=e[u].dataCount;n=Math.max(n,h),o=Math.max(o,l),a[u]=new Array(h);for(var c=0;c<a[u].length;c++)a[u][c]=255&t.buffer[c+r;r+=h}for(var f=0,g=Math.ceil(n/8),f=0;f<e.length;f++)i[f]=new Array(g);for(var d=0;d<g;d++)for(var p=0;p<e.length;p++)for(var v=0;v<n;v++)null!=a[p][v]&&(i[p][Math.floor(v/8)]|=128>>7-v%8<<7-p%4);for(var y=new Array,m=0,p=0;4>p;p++)for(var _=0;_<i[p].length;_++){var w=i[p][_];if(void 0!==y[m]){for(var b=0;void 0!==y[m];)m++,b++;b>1&&(m+=b-1)}y[m]=w,m++}for(var S=new Array,m=0;m<y.length;m++)S.push(y[m]);return S},PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,RS_BLOCK_TABLE:[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,61,48],[6,60,36],[2,36,16,6,37,17],[4,36,12,2,37,13],[2,61,48],[6,60,36],[4,36,12,2,37,13],[2,86,68],[8,69,43],[4,43,19,4,44,20],[4,43,15,4,44,16],[2,121,97],[8,72,41],[8,73,42],[4,36,12,8,37,13],[2,121,97],[4,54,32,4,55,33],[4,54,29,2,55,30],[4,36,12,8,37,13],[2,146,116],[8,74,45],[4,54,29,4,55,30],[4,36,12,8,37,13],[2,146,116],[8,74,45],[4,54,29,2,55,30],[4,36,12,8,37,13],[4,162,129],[6,72,41,2,73,42],[4,54,29,4,55,30],[6,36,12,6,37,13],[6,162,129],[6,72,45,2,73,46],[4,54,29,6,55,30],[4,36,12,6,37,13],[2,180,145],[8,74,45,4,75,46],[8,54,29,4,55,30],[6,36,12,6,37,13],[4,180,145],[8,74,45,4,75,46],[4,54,29,2,55,30,6,56,31],[4,36,12,2,37,13,8,38,14],[2,201,160],[4,83,51,5,84,52],[2,43,15,13,44,16],[4,83,51,4,84,52],[2,43,11,17,44,12],[6,83,51,4,84,52],[6,83,51,2,84,53],[4,86,54,4,87,55],[2,86,54,8,87,55],[6,101,69],[4,86,54,4,87,55],[2,43,15,14,44,16],[6,86,54,4,87,55],[2,43,11,16,44,12],[4,101,72,2,102,73],[8,101,74,4,102,75],[4,101,72,8,102,73],[2,116,85,4,117,86],[6,116,85,4,117,86],[6,43,15,14,44,16],[6,116,85,4,117,86],[2,43,11,18,44,12],[4,133,93,4,134,94],[8,133,93,4,134,94],[8,43,15,13,44,16],[4,133,93,4,134,94],[2,43,11,18,44,12],[2,154,109,4,155,110],[6,154,109,4,155,110],[8,154,109,4,155,110],[6,154,109,2,155,110],[4,180,121,2,181,122],[10,180,121,4,181,122],[8,180,121,4,181,122],[4,180,121,6,181,122],[2,202,125,4,203,126],[8,202,125,4,203,126],[10,202,125,4,203,126],[6,202,125,2,203,126],[2,216,129,8,217,130],[6,216,129,4,217,130],[2,43,15,26,44,16],[10,216,129,4,217,130],[6,43,11,26,44,12],[4,232,137,4,233,138],[12,232,137,4,233,138],[6,43,11,26,44,12],[4,232,137,4,233,138],[2,250,140,8,251,141],[12,250,140,4,251,141],[4,250,140,8,251,141],[4,250,140,8,251,141],[4,250,140,6,251,141],[2,250,140,8,251,141],[8,250,140,4,251,141],[8,250,140,4,251,141],[2,250,140,12,251,141],[4,250,140,4,251,141],[6,250,140,12,251,141],[2,250,140,6,251,141,6,252,142],[4,250,140,6,251,141,2,252,142],[6,250,140,6,251,141,2,252,142],[8,250,140,4,251,141],[2,250,140,10,251,141],[10,250,140,4,251,141],[4,250,140,8,251,141],[2,250,140,4,251,141,8,252,142]]};
    qrcode.util.QRData=function(t){this.mode=qrcode.util.MODE_8BIT_BYTE,this.data=t};
    qrcode.util.QRData.prototype={getLength:function(){return this.data.length},write:function(t){for(var e=0;e<this.data.length;e++)t.put(this.data.charCodeAt(e),8)}};
    qrcode.util.BitBuffer=function(){this.buffer=new Array,this.length=0};
    qrcode.util.BitBuffer.prototype={get:function(t){var e=Math.floor(t/8);return 1==(1&this.buffer[e]>>>7-t%8)},put:function(t,e){for(var r=0;e>r;r++)this.putBit(1==(1&t>>>e-r-1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};
    qrcode.util.RSBlock=function(t,e){this.totalCount=t,this.dataCount=e};
    qrcode.util.RSBlock.prototype.getTotalCount=function(){return this.totalCount};
    qrcode.util.RSBlock.prototype.getDataCount=function(){return this.dataCount};
    qrcode.util.MODE_NUMBER=1;
    qrcode.util.MODE_ALPHA_NUM=2;
    qrcode.util.MODE_8BIT_BYTE=4;
    qrcode.util.MODE_KANJI=8;
    </script>
    
    <!-- Aplicacion Admin -->
    <script src="js/admin.js"></script>
</body>
</html>
